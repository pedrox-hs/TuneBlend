subprojects {
    def isRecordRequested = project.gradle.startParameter.taskNames.any {
        it =~ /recordPaparazzi/
    }
    if (isRecordRequested) return

    tasks.matching {
        it.name ==~ /test[A-Z].+UnitTest/
    }.configureEach { task ->
        task.finalizedBy provider {
            tasks.matching {
                def variantName = task.variantName.capitalize() - 'UnitTest'
                it.name == "verifyPaparazzi${variantName}"
            }
        }
    }
}
